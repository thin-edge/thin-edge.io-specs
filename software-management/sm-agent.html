<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Software Management Agent - Thin Edge Specifications</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../telemetry-data/index.html"><strong aria-hidden="true">1.</strong> Telemetry Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../telemetry-data/thin-edge-json.html"><strong aria-hidden="true">1.1.</strong> Thin Edge Json</a></li><li class="chapter-item expanded "><a href="../telemetry-data/mqtt-bus.html"><strong aria-hidden="true">1.2.</strong> MQTT Bus</a></li></ol></li><li class="chapter-item expanded "><a href="../alarms/alarm-handling.html"><strong aria-hidden="true">2.</strong> Alarm Handling</a></li><li class="chapter-item expanded "><a href="../supported-operations/index.html"><strong aria-hidden="true">3.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../supported-operations/requirements.html"><strong aria-hidden="true">3.1.</strong> Requirements</a></li><li class="chapter-item expanded "><a href="../supported-operations/principles.html"><strong aria-hidden="true">3.2.</strong> Principles</a></li><li class="chapter-item expanded "><a href="../supported-operations/thin-edge-supported-operations.html"><strong aria-hidden="true">3.3.</strong> Examples</a></li><li class="chapter-item expanded "><a href="../supported-operations/command-line-support.html"><strong aria-hidden="true">3.4.</strong> Command line support</a></li></ol></li><li class="chapter-item expanded "><a href="../software-management/index.html"><strong aria-hidden="true">4.</strong> Software management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../software-management/usecase-update-swlist.html"><strong aria-hidden="true">4.1.</strong> Use-Case Update Software-List</a></li><li class="chapter-item expanded "><a href="../software-management/plugin-api.html"><strong aria-hidden="true">4.2.</strong> Package Manager Plugin API</a></li><li class="chapter-item expanded "><a href="../software-management/sm-agent.html" class="active"><strong aria-hidden="true">4.3.</strong> Software Management Agent</a></li><li class="chapter-item expanded "><a href="../software-management/c8y-mapper-operation-handling.html"><strong aria-hidden="true">4.4.</strong> C8Y Mapper Operation Handling</a></li><li class="chapter-item expanded "><a href="../software-management/thin-edge-json-mapping-to-from-c8y.html"><strong aria-hidden="true">4.5.</strong> Thin Edge JSON Mapping to/from C8Y</a></li></ol></li><li class="chapter-item expanded "><a href="../decisions/open-decisions.html"><strong aria-hidden="true">5.</strong> Open Decisions</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Thin Edge Specifications</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="software-management-agent"><a class="header" href="#software-management-agent">Software Management Agent</a></h1>
<p>The software management agent (referred to as <code>SM Agent</code> in the rest of this document) is the component that's responsible for the software management operations on a Thin Edge device.
It primarily interacts with a <code>Cloud Mapper</code> and one or more <code>Software Plugins</code> backed by a software package manager (apt, snap, docker etc).</p>
<p>The <code>Cloud Mapper</code> is the process that's responsible for discovering the capabilities of the device and reporting that to the cloud, cloud message mapping as well as any other cloud-specific processing logic.
The cloud mapper's behaviour handling of software management requests/response are describe in detail here <a href="./c8y-mapper-operation-handling.html">c8y-mapper-operation-handling.md</a></p>
<p>The <code>Software Plugin</code> handles the installation/removal of software modules with the help of package manager, when called by the <code>SM Agent</code>.
The software plugin specification is captured in detail here <a href="./plugin-api.html">./plugin-api.md</a></p>
<h1 id="sm-agent-startup"><a class="header" href="#sm-agent-startup">SM Agent Startup</a></h1>
<p>The sequence of operations and message exchanges happening on every startup of the sm-agent (initial startup on <code>tedge connect</code>, service restart, device restarts etc).</p>
<pre class="mermaid">sequenceDiagram
    participant Software Plugin
    participant SM Agent
    participant Cloud Mapper
    alt If a SoftwareUpdateOperation was in-progress as found in persistence store
        SM Agent-&gt;&gt;Cloud Mapper: SoftwareUpdateOperation FAILED
        SM Agent--&gt;&gt;SM Agent: Clear SoftwareUpdateOperation in-progress flag from persistence store
    end

    alt If any software plugins available on the device
        SM Agent-&gt;&gt;Cloud Mapper: Declare SoftwareList+SoftwareUpdate capabilities
    end

    alt If any SoftwareUpdateOperation is PENDING
        Cloud Mapper--&gt;&gt;SM Agent: SoftwareUpdateOperation
    end

</pre>
<p>On every startup, sm-agent checks if a <code>SoftwareUpdateOperation</code> was in progress before the startup, from its persistent store.
If yes, it means that the sm-agent crashed or the device/service got restarted while the update operation was in-progress.
As long as we don't support resumption of software update operations, it's better to just mark the last operation failed so that the users can retry the update operation.</p>
<p>For now, persisting some information that the <code>SoftwareUpdateOperation</code> is in-progress is sufficient.
Once we start supporting software update resumption after crashes/restarts, the entire software update list itself will have to be persisted and updated as the operation is being processed.</p>
<p>On startup, the agent also declares its capabilities to the <code>Cloud Mapper</code> so that the cloud mapper communicate the same to the cloud.
One receipt of this capability announcement message, the mapper will respond back with the oldest PENDING operation for that capability, if any are queued on the cloud.</p>
<h1 id="sm-agent-runtime"><a class="header" href="#sm-agent-runtime">SM Agent Runtime</a></h1>
<p>The SM Agent needs to handle two kinds of requests from the cloud: software list request and software update request.</p>
<p>The sequence of operations on the receipt of a software list request is as follows:</p>
<pre class="mermaid">sequenceDiagram
    participant Software Plugin
    participant SM Agent
    participant Cloud Mapper
    Cloud Mapper--&gt;&gt;SM Agent: SoftwareListRequest
    SM Agent -&gt;&gt; Cloud Mapper: Status executing
    loop Each Plugin
        SM Agent-&gt;&gt;Software Plugin: plugin-cmd list
        Software Plugin--&gt;&gt;SM Agent: list cmd output
    end
    SM Agent-&gt;&gt;Cloud Mapper: SoftwareListResponse
</pre>
<p>The sequence of operations on the receipt of a software update request is as follows:</p>
<pre class="mermaid">sequenceDiagram
    participant Software Plugin
    participant SM Agent
    participant Cloud Mapper

    alt if a SoftwareUpdateOperation is PENDING
        Cloud Mapper--&gt;&gt;SM Agent: SoftwareUpdateOperation

        SM Agent-&gt;&gt;SM Agent: Persist SoftwareUpdateOperation in-progress
        SM Agent-&gt;&gt;Cloud Mapper: SoftwareUpdateOperation EXECUTING

        loop Each plugin
            SM Agent-&gt;&gt;Software Plugin: plugin-cmd prepare
            Software Plugin--&gt;&gt;SM Agent: Exit code + stdout/stderr
        end

        loop Each module in SoftwareUpdateOperation module list
            alt If module action is install
                SM Agent-&gt;&gt;Software Plugin: plugin-cmd install module
            else
                SM Agent-&gt;&gt;Software Plugin: plugin-cmd uninstall module
            end
            Software Plugin--&gt;&gt;SM Agent: Exit code + stdout/stderr
        end

        loop Each plugin
            SM Agent-&gt;&gt;Software Plugin: plugin-cmd finalize
            Software Plugin--&gt;&gt;SM Agent: Exit code + stdout/stderr

            SM Agent-&gt;&gt;Software Plugin: plugin-cmd list
            Software Plugin--&gt;&gt;SM Agent: list cmd output
        end

        SM Agent-&gt;&gt;Cloud Mapper: SoftwareList

        alt If SoftwareUpdateOperation successful and SoftwareListStatus successful
            SM Agent-&gt;&gt;Cloud Mapper: SoftwareUpdateOperation SUCCESSFUL
        else
            SM Agent-&gt;&gt;Cloud Mapper: SoftwareUpdateOperation FAILED
        end

        SM Agent--&gt;&gt;SM Agent: Clear SoftwareUpdateOperation in-progress flag from persistence store
    end
</pre>
<p>The SM Agent will process only one <code>SoftwareUpdateOperation</code> at a time.
If a duplicate operation is received while in the middle of processing one operation, the new request will be ignored.
Ignoring is okay as the SM Agent expects to retrieve it later on, after the current operation processing is complete, from the mapper via its PENDING requests queue.
The mapper can choose to persist such PENDING requests on its own if the cloud that it supports doesn't support such queueing.
But, the SM Agent won't persist such requests.</p>
<p>While processing the software update list, the modules are installed/uninstalled in the order that they were received from the cloud. However the SW update operation is a &quot;declarative&quot; operation by definition, so there is no intentional order from the Cloud operator. Instead the SM agent can define an order that fits best so that the intended package amount defined by the sw-list will be achieved.</p>
<p>NOTE for Furture extension: If the order need to be decided by a specific Package Manager (e.g. to consider/fix dependencies between packages in the sw-list) the Package Manager plugin should be able to be feeded with all packages of according type at once, instead of package by package. Therefore the Package Manager Plugin API will be extended with another command (proposed name &quot;exec-list&quot;) later.</p>
<p>While installing/uinstalling the modules one by one, we have the option to either fail-fast as soon as one installation/uninstallation fails or keep track of the failures and continue installing/uninstalling the rest of the software modules.
Fail-fast would be a better choice as in the case of a failure, the user is more likely to retry that operation after making any changes to the original software update list that he prepared.</p>
<p>Once the mapper receives the SUCCESSFUL or FAILED status for an update operation from the SM Agent,
it can send the next PENDING <code>SoftwareUpdateOperation</code> to the SM Agent and the whole request processing cycle will repeat.</p>
<h1 id="thin-edge-json-specification-for-commands"><a class="header" href="#thin-edge-json-specification-for-commands">Thin Edge JSON Specification for Commands</a></h1>
<p>A topic scheme like <code>tedge/commands/req/&lt;component&gt;/&lt;action&gt;</code> is used for inbound operation requests.
The corresponding operation response need to be sent to <code>tedge/commands/res/&lt;component&gt;/&lt;action&gt;</code>.
In the future we can add sub actions as well, as in <code>tedge/commands/req/&lt;component&gt;/&lt;action&gt;/&lt;sub-action&gt;</code> 
or even more levels in the topic hierarchy, if needed.</p>
<p>For example, the request to fetch the software list from the agent needs to be sent to <code>tedge/commands/req/software/list</code> and the corresponding software list response will be sent to <code>tedge/commands/res/software/list</code>.
Similar scheme can be used for other operations as well in future as captured in the following table:</p>
<table><thead><tr><th>Operation</th><th>Request Topic</th><th>Response Topic</th></tr></thead><tbody>
<tr><td>Get Software List</td><td><code>tedge/commands/req/software/list</code></td><td><code>tedge/commands/res/software/list</code></td></tr>
<tr><td>Software Update</td><td><code>tedge/commands/req/software/update</code></td><td><code>tedge/commands/res/software/update</code></td></tr>
<tr><td>Sync Software List</td><td><code>tedge/commands/req/software/sync</code></td><td><code>tedge/commands/res/software/sync</code></td></tr>
<tr><td>Apply Profile</td><td><code>tedge/commands/req/profile/apply</code></td><td><code>tedge/commands/res/profile/apply</code></td></tr>
<tr><td>Get Configuration</td><td><code>tedge/commands/req/configuration/get</code></td><td><code>tedge/commands/res/configuration/get</code></td></tr>
<tr><td>Set Configuration</td><td><code>tedge/commands/req/configuration/set</code></td><td><code>tedge/commands/res/configuration/set</code></td></tr>
<tr><td>Get Log</td><td><code>tedge/commands/req/log/get</code></td><td><code>tedge/commands/res/log/get</code></td></tr>
<tr><td>Restart  device</td><td><code>tedge/commands/req/control/restart</code></td><td><code>tedge/commands/res/control/restart</code></td></tr>
<tr><td>Remote  connect</td><td><code>tedge/commands/req/control/connect</code></td><td><code>tedge/commands/res/control/connect</code></td></tr>
</tbody></table>
<p>Having such dedicated topics for each command enables Thin Edge components to selectively subscribe to only the commands that they're interested in.
If one component wants to subscribe to all commands for a single component like <code>software</code>, it can still subscribe to <code>tedge/commands/req/software/#</code>.
If one component wants to subscribe to all commands, then it can even subscribe to <code>tedge/commands/req/#</code>.</p>
<h2 id="ordering-of-operations-along-multiple-topics"><a class="header" href="#ordering-of-operations-along-multiple-topics">Ordering of operations along multiple topics</a></h2>
<p>Since MQTT doesn't guarantee ordered delivery of messages across different topics, the ordering of actions for a single component,
or even the ordering of actions between different components will have to be controlled by the publisher, which is the <code>Cloud Mapper</code>.
When strict ordering is required between commands, like a software update command followed by a device restart command,
the <code>Cloud Mapper</code> needs to issue the software update request first, wait for its response and only then issue the device restart request.
It can also send unordered commands like a log request or remote control parallelly, even when some other ordered commands are being executed.</p>
<h1 id="thin-edge-json-specification-for-software-management-commands"><a class="header" href="#thin-edge-json-specification-for-software-management-commands">Thin Edge JSON Specification for Software Management Commands</a></h1>
<h2 id="declaring-capabilities"><a class="header" href="#declaring-capabilities">Declaring Capabilities</a></h2>
<p>Topics to publish the request to:</p>
<ul>
<li>For software update: <code>tedge/capabilities/software/update</code></li>
<li>For software list: <code>tedge/capabilities/software/list</code></li>
<li>For software sync: <code>tedge/capabilities/software/sync</code></li>
</ul>
<p>There's no payload to send.</p>
<p>The mapper, on receipt of this request will publish any PENDING operations of that kind to the designated topics like <code>tedge/commands/req/software/list</code>, <code>tedge/commands/req/configuration/set</code> etc.
If there are no PENDING operations of that kind, then mapper won't send any response.</p>
<h2 id="software-list-operation"><a class="header" href="#software-list-operation">Software List Operation</a></h2>
<h3 id="thin-edge-json-software-list-request"><a class="header" href="#thin-edge-json-software-list-request">Thin Edge JSON Software List Request</a></h3>
<p>Topic to publish the software list request to: <code>tedge/commands/req/software/list</code></p>
<p>Request payload: </p>
<pre><code class="language-json">{
    &quot;id&quot;: 123
}
</code></pre>
<p>Some unique id must be generated by the requestor and this <code>id</code> is sent back in the response for correlation.</p>
<h3 id="thin-edge-json-software-list-response"><a class="header" href="#thin-edge-json-software-list-response">Thin Edge JSON Software List Response</a></h3>
<p>Topic to subscribe for the software list response: <code>tedge/commands/res/software/list</code></p>
<p>Payload format:</p>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;: &quot;successful&quot;,
    &quot;currentSoftwareList&quot;: [
        {
            &quot;type&quot;: &quot;debian&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nodered&quot;,
                    &quot;version&quot;: &quot;1.0.0&quot;
                },
                {
                    &quot;name&quot;: &quot;collectd&quot;,
                    &quot;version&quot;: &quot;5.7&quot;
                }
            ]
        },
        {
            &quot;type&quot;: &quot;docker&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nginx&quot;,
                    &quot;version&quot;: &quot;1.21.0&quot;
                },
                {
                    &quot;name&quot;: &quot;mongodb&quot;,
                    &quot;version&quot;: &quot;4.4.6&quot;
                }
            ]
        }
    ]
}
</code></pre>
<p><strong>Payload fields:</strong></p>
<p>In the top-level array, there will be one entry each for every plugin on the device, if the plugin reports a non-empty software list, when queried for one.</p>
<ul>
<li><code>id</code> is used to correlate any response from the mapper while processing the software list. If the mapper fails to process the list, the error will published </li>
<li><code>type</code> captures the type of software module that's being reported in the list.
It will be the name of the plugin that reports this list.
It can be optional and can be empty for the default software module type of the device, if a default plugin is configured on the device.</li>
<li><code>list</code> is an array of software modules represented as JSON objects. This field is mandatory.</li>
<li><code>name</code> in the software module JSON captures the name of the software module, which is mandatory.</li>
<li><code>version</code> in the software module JSON captures the name of the software module, which is optional.</li>
</ul>
<p>If fetching the software list had failed, the reponse would have indicated a failure as follows:</p>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;: &quot;failed&quot;,
    &quot;reason&quot;: &quot;Request timed-out&quot;
}
</code></pre>
<h4 id="executing-status-payload"><a class="header" href="#executing-status-payload">Executing Status Payload</a></h4>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;: &quot;executing&quot;
}
</code></pre>
<h2 id="software-update-operation"><a class="header" href="#software-update-operation">Software Update Operation</a></h2>
<h3 id="thin-edge-json-software-update-request"><a class="header" href="#thin-edge-json-software-update-request">Thin Edge JSON Software Update Request</a></h3>
<p>Topic to subscribe to: <code>tedge/commands/req/software/update</code></p>
<p>Payload format:</p>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;updateList&quot;: [
        {
            &quot;type&quot;: &quot;debian&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nodered&quot;,
                    &quot;version&quot;: &quot;1.0.0&quot;,
                    &quot;action&quot;: &quot;install&quot;
                },
                {
                    &quot;name&quot;: &quot;collectd&quot;,
                    &quot;version&quot;: &quot;5.7&quot;,
                    &quot;url&quot;: &quot;https://collectd.org/download/collectd-tarballs/collectd-5.12.0.tar.bz2&quot;,
                    &quot;action&quot;: &quot;install&quot;
                }
            ]
        },
        {
            &quot;type&quot;: &quot;docker&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nginx&quot;,
                    &quot;version&quot;: &quot;1.21.0&quot;,
                    &quot;action&quot;: &quot;install&quot;
                },
                {
                    &quot;name&quot;: &quot;mongodb&quot;,
                    &quot;version&quot;: &quot;4.4.6&quot;,
                    &quot;action&quot;: &quot;remove&quot;
                }
            ]
        }
    ]
}
</code></pre>
<h3 id="thin-edge-json-software-update-response"><a class="header" href="#thin-edge-json-software-update-response">Thin Edge JSON Software Update Response</a></h3>
<p>Once a software-update operation is received, it must be acknowledged with an EXECUTING response, followed by a SUCCESSFUL or FAILED response.</p>
<p>Topic to subscribe for the software update response: <code>tedge/commands/res/software/update</code></p>
<h4 id="executing-status-payload-1"><a class="header" href="#executing-status-payload-1">Executing Status Payload</a></h4>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;: &quot;executing&quot;
}
</code></pre>
<h4 id="successful-status-payload"><a class="header" href="#successful-status-payload">Successful Status Payload</a></h4>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;: &quot;successful&quot;,
    &quot;currentSoftwareList&quot;: [
        {
            &quot;type&quot;: &quot;debian&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nodered&quot;,
                    &quot;version&quot;: &quot;1.0.0&quot;,
                },
                {
                    &quot;name&quot;: &quot;collectd&quot;,
                    &quot;version&quot;: &quot;5.7&quot;
                }
            ]
        },
        {
            &quot;type&quot;: &quot;docker&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nginx&quot;,
                    &quot;version&quot;: &quot;1.21.0&quot;,
                },
                {
                    &quot;name&quot;: &quot;mongodb&quot;,
                    &quot;version&quot;: &quot;4.4.6&quot;,
                }
            ]
        }
    ]
}
</code></pre>
<p>Sending the current software list along with the status will help the cloud providers to show the most up-to-date software list after an update was performed, which would include any extra dependencies that got installed/removed as part of the update.</p>
<h4 id="failed-status-payload"><a class="header" href="#failed-status-payload">Failed Status Payload</a></h4>
<pre><code class="language-json">{
    &quot;id&quot;: 123,
    &quot;status&quot;:&quot;failed&quot;,
    &quot;reason&quot;:&quot;Partial failure: Couldn't install collectd and nginx&quot;,
    &quot;currentSoftwareList&quot;: [
        {
            &quot;type&quot;: &quot;debian&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nodered&quot;,
                    &quot;version&quot;: &quot;1.0.0&quot;,
                }
            ]
        },
        {
            &quot;type&quot;: &quot;docker&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;nginx&quot;,
                    &quot;version&quot;: &quot;1.21.0&quot;,
                }
            ]
        }
    ],
    &quot;failures&quot;:[
        {
            &quot;type&quot;:&quot;debian&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;:&quot;collectd&quot;,
                    &quot;version&quot;:&quot;5.7&quot;,
                    &quot;action&quot;:&quot;install&quot;,
                    &quot;reason&quot;:&quot;Network timeout&quot;
                }
            ]
        },
        {
            &quot;type&quot;:&quot;docker&quot;,
            &quot;modules&quot;: [
                {
                    &quot;name&quot;: &quot;mongodb&quot;,
                    &quot;version&quot;: &quot;4.4.6&quot;,
                    &quot;action&quot;:&quot;remove&quot;,
                    &quot;reason&quot;:&quot;Other components dependent on it&quot;
                }
            ]
        }
    ]
}
</code></pre>
<p>Sending the <code>currentSoftwareList</code> along with the status even in the case of a failure will help the cloud providers to show the most up-to-date software list,
especially in the case of partial failures, which would contain the modules and dependencies that got installed,
even though the overall update failed.</p>
<p>The <code>failures</code> fragment captures the modules that could not be installed/uninstalled with the reason reported by the software plugin.
If we skip the installation/uninstallation of some modules because of earlier failures,
the failure <code>reason</code> can be reorted as <code>Skipped</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../software-management/plugin-api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../software-management/c8y-mapper-operation-handling.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../software-management/plugin-api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../software-management/c8y-mapper-operation-handling.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
                <script type="text/javascript" src="../mermaid.min.js"></script>
                <script type="text/javascript" src="../mermaid-init.js"></script>
        
        
    </body>
</html>
