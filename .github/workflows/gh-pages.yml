name: Build and Deploy to Github Pages

on:
  push:
    branches:
      - main # Here source code branch is `master`, it could be other branch

# jobs:
#   build_and_deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2

#       # Use GitHub Actions' cache to cache dependencies on servers
#       - uses: actions/cache@v2
#         with:
#           path: vendor/bundle
#           key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
#           restore-keys: |
#             ${{ runner.os }}-gems-

#       # Use GitHub Deploy Action to build and deploy to Github
#       - uses: jeffreytse/jekyll-deploy-action@v0.2.1
#         with:
#           provider: "github"
#           token: ${{ secrets.GH_TOKEN }} # It's your Personal Access Token(PAT)
#           repository: "" # Default is current repository
#           branch: "gh-pages" # Default is gh-pages for github provider
#           jekyll_src: "./" # Default is root directory
#           jekyll_cfg: "_config.yml" # Default is _config.yml
#           jekyll_baseurl: "" # Default is according to _config.yml
#           bundler_ver: ">=0" # Default is latest bundler version
#           cname: "" # Default is to not use a cname
#           actor: "" # Default is the GITHUB_ACTOR

jobs:
  deploy:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - uses: actions/checkout@v2

      - name: Setup mdBook
        uses: peaceiris/actions-mdbook@v1
        with:
          mdbook-version: "0.4.10"
          # mdbook-version: 'latest'

      - uses: actions-rs/install@v0.1
        with:
          crate: mdbook-toc
          version: latest

      - uses: actions-rs/install@v0.1
        with:
          crate: mdbook-mermaid
          version: latest

      - run: mdbook build

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./book
